<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Virtual Labs</title>
    <link rel="stylesheet" href="../../../assets/css/vlabs-style.css" />
    <link rel="shortcut icon" href="../../../assets/images/favicon.ico" />
    <script>
        let berChart;

        function toggleSNRInput() {
            const specificSNRInput = document.getElementById('specificSNRInput');
            const rangeSNRInput = document.getElementById('rangeSNRInput');
            if (document.getElementById('specific').checked) {
                specificSNRInput.style.display = 'block';
                rangeSNRInput.style.display = 'none';
            } else {
                specificSNRInput.style.display = 'none';
                rangeSNRInput.style.display = 'block';
            }
        }

        function plotBER() {
            const numBits = parseInt(document.getElementById('numBits').value);

            let SNR_dB;
            if (document.getElementById('specific').checked) {
                const specificSNR = parseFloat(document.getElementById('specificSNR').value);
                SNR_dB = [specificSNR];
            } else {
                const startSNR = parseFloat(document.getElementById('startSNR').value);
                const endSNR = parseFloat(document.getElementById('endSNR').value);
                SNR_dB = Array.from({ length: endSNR - startSNR + 1 }, (_, i) => i + startSNR);
            }

            const SNR_lin = SNR_dB.map(dB => Math.pow(10, dB / 10));

            // Generate random binary data
            const data = Array.from({ length: numBits }, () => Math.round(Math.random()));

            // AM modulation
            const A = 1; // Amplitude of the carrier signal
            const am_symbols = data.map(bit => A * (2 * bit - 1)); // AM modulation

            // Initialize BER array
            const BER = new Array(SNR_dB.length).fill(0);

            // Calculate BER
            SNR_dB.forEach((dB, k) => {
                // Add noise
                const noise_power = A ** 2 / SNR_lin[k]; // Noise power assuming unity signal power
                const noise = am_symbols.map(() => Math.sqrt(noise_power) * Math.random());
                const received_symbols = am_symbols.map((symbol, index) => symbol + noise[index]);

                // Decode received data
                const decoded_data = received_symbols.map(symbol => symbol > A / 2 ? 1 : 0); // Demodulation

                // Calculate BER
                const errors = decoded_data.reduce((acc, bit, index) => acc + (bit !== data[index] ? 1 : 0), 0);
                BER[k] = errors / numBits;
            });

            if (berChart) {
                berChart.data.labels = SNR_dB;
                berChart.data.datasets[0].data = BER;
                berChart.update();
            } else {
                const ctx = document.getElementById('berChart').getContext('2d');
                berChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: SNR_dB,
                        datasets: [{
                            label: 'BER vs SNR',
                            data: BER,
                            borderColor: 'blue',
                            backgroundColor: 'rgba(0, 0, 255, 0.1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            xAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'SNR (dB)'
                                }
                            }],
                            yAxes: [{
                                type: 'logarithmic',
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Bit Error Rate (BER)'
                                }
                            }]
                        },
                        title: {
                            display: true,
                            text: 'BER vs SNR in AM'
                        }
                    }
                });
            }
        }
    </script>
  </head>
  <body>
    <header class="border-b-orange-500 border-b-8">
      <nav class="flex justify-between">
        <button class="px-4 py-1 rounded-r-md border-r" onclick="showModal()">
          <img
            class="w-[30px] h-[30px]"
            src="../../../assets/images/menu.png"
          />
        </button>
        <div class="flex justify-center">
          <a href="https://vlab.co.in" class="navbar-brand">
            <img
              src="../../../assets/images/vlabs-color-small-moe.jpg"
              alt="vlabs logo"
              class="mx-4 px-4 w-[118px] h-[70px] py-2"
            />
          </a>
        </div>
        <div
          id="headerNavbar"
          class="flex flex-1 justify-center text-[24px] text-[#2c99ce] items-center"
        >
          <h2>AM BERvsSNR</h2>
        </div>
      </nav>
      <!-- overlaynavbar -->
      <div
        class="overlaycontainer w-[100%] h-[100vh] bg-[#00000080] fixed top-[0%] -z-50 opacity-0"
      ></div>
      <div
        class="overlaysignupform ease-in-out duration-100 fixed -top-[150%] left-[50%] -translate-x-1/2 z-50"
      >
        <div class="flex justify-center items-center px-4 h-[100vh] w-[100vw]">
          <div
            class="relative bg-white border border-solid border-[#00000033] rounded-md w-[498px] flex flex-col overflow-y-auto"
          >
            <div class="p-4 flex justify-between items-center border-b">
              <div class="w-[87px] h-[50px] flex justify-center items-center">
                <a href="https://vlab.co.in">
                  <img
                    src="../../../assets/images/vlabs-color-small-moe.jpg"
                    alt="vlabs logo"
                    class="w-[71px] h-[40px]"
                  />
                </a>
              </div>
              <button class="w-[24px] h-[24px]" onclick="closeModal()">
                <img src="../../../assets/images/close.png" />
              </button>
            </div>
            <div
              class="p-4 flex flex-col text-[19.2px] font-bold text-[#3e6389]"
            >
              <div class="flex justify-center">
                <a
                  href="../index.html"
                  class="p-2 hover:text-[#343a40] hover:underline"
                >
                  Aim
                </a>
              </div>
              <div class="flex justify-center">
                <a
                  href="../theory.html"
                  class="p-2 hover:text-[#343a40] hover:underline"
                >
                  Theory
                </a>
              </div>
              <div class="flex justify-center">
                <a
                  href="../procedure.html"
                  class="p-2 hover:text-[#343a40] hover:underline"
                >
                  Procedure
                </a>
              </div>
              <div class="flex justify-center">
                <a
                  href="../simulation.html"
                  class="p-2 text-[#FF6600] hover:underline"
                >
                  Simulation
                </a>
              </div>
              <div class="flex justify-center">
                <a
                  href="../observations.html"
                  class="p-2 hover:text-[#343a40] hover:underline"
                >
                  Observations
                </a>
              </div>
              <div class="flex justify-center">
                <a
                  href="../references.html"
                  class="p-2 hover:text-[#343a40] hover:underline"
                >
                  References
                </a>
              </div>
              <div class="flex justify-center">
                <a
                  href="../feedback.html"
                  class="p-2 hover:text-[#343a40] hover:underline"
                >
                  Feedback
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <!-- sidebar and body -->
    <div class="flex min-h-[80vh]">
      <div class="px-6 pb-6 mt-1 flex-1">
        <div class="">
          <div class="flex flex-col justify-center">
            <div class="flex max-lg:flex-col gap-x-12 gap-y-2 mt-2">
              <div class="">
                <div class="flex items-center gap-1">
                  <label for="numBits">Number of Bits:</label>
                  <input
                    class="border border-black px-2 py-1 rounded-sm"
                    type="number"
                    id="numBits"
                    min="1"
                    value="1000000"
                  />
                </div>
              </div>
            </div>
            <div class="flex max-lg:flex-col gap-x-8 gap-y-2 mt-2">
              <div class="">
                <div class="flex items-center gap-1">
                  <input
                    class="px-2 py-1 w-4 h-4"
                    id="specific"
                    name="snrType"
                    type="radio"
                    value="specific"
                    onclick="toggleSNRInput()"
                  />
                  <label for="specificSNR">Specific SNR:</label>
                  <input
                    class="max-lg:ml-10 border border-black px-2 py-1 rounded-sm"
                    type="number"
                    id="specificSNR"
                    value="0"
                  />
                </div>
              </div>
              <div class="">
                <div class="flex items-center gap-1">
                  <input
                    class="px-2 py-1 w-4 h-4"
                    id="range"
                    value="range"
                    name="snrType"
                    type="radio"
                    checked
                    onclick="toggleSNRInput()"
                  />
                  <label for="startSNR">SNR Range:</label>
                  <input
                    class="max-lg:ml-10 border border-black px-2 py-1 rounded-sm"
                    type="number"
                    id="startSNR"
                    value="-10"
                  />
                  <label for="endSNR">to</label>
                  <input
                    class="max-lg:ml-10 border border-black px-2 py-1 rounded-sm"
                    type="number"
                    id="endSNR"
                    value="10"
                  />
                </div>
              </div>
            </div>
          </div>
          <div class="flex justify-center pt-4">
            <button
              class="bg-blue-500 text-white rounded-md px-2 py-1"
              class="button"
              onclick="plotBER()"
            >
              Plot Graph
            </button>
          </div>
          <canvas id="berChart" width="600" height="400"></canvas>
        </div>
      </div>
    </div>
    <script src="../../../assets/js/toggleSidebar.js"></script>
  </body>
</html>
